<div class="exercise-select-container" data-controller="exercise-select" data-exercise-select-data-value="<%= @date %>">

  <% @body_parts.each do |body_part| %>
    <% exercises = @exercises_by_part[body_part] || [] %>

    <div class="exercise-select-card mb-4 p-3">

      <!-- 部位名 -->
      <h4 class="part-title mb-2"><%= body_part.name %></h4>

      <!-- 最初の2種目 -->
      <% exercises.first(2).each do |ex| %>
        <div class="exercise-option py-2"
             data-action="click->exercise-select#select"
             data-id="<%= ex.id %>">
          <%= ex.name %>
        </div>
      <% end %>

      <% remaining = exercises.drop(2) %>

      <% if remaining.any? %>
        <!-- 非表示の種目 -->
        <div class="extra-exercise d-none">
          <% remaining.each do |ex| %>
            <div class="exercise-option py-2"
                 data-action="click->exercise-select#select"
                 data-id="<%= ex.id %>">
              <%= ex.name %>
            </div>
          <% end %>
        </div>
      <% end %>

      <div class="d-flex justify-content-between align-items-center mt-2">

        <% if remaining.any? %>
          <button type="button"
                  class="toggle-btn"
                  data-action="click->exercise-select#toggle">
            ▼ もっと見る
          </button>
        <% else %>
          <span></span>
        <% end %>

        <%= link_to "＋ 種目を追加",
            new_body_part_exercise_path(body_part, date: @date),
            class: "add-exercise_btn" %>
      </div>

    </div>

  <% end %>

</div>
